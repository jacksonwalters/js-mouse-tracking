<!-- 

    Copyright 2012 Jackson Walters

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<input id="start" type="button" value="Start" name="start" title="start" onclick="doTimer();document.getElementById('start').value='Started';">
<input id="stop" type="button" value="Finish" name="stop" title="stop" onclick="stopCount();">

<br>

<style type="text/css">
#mousearea { 
width:480px; 
height:320px; 
background-color:lightgray;
}
</style>

<div id="mousearea">
</div>

<input id="xPos" name="xPos" value="" type="hidden">
<input id="yPos" name="yPos" value="" type="hidden">
<input id="time" name="time" value="" type="hidden">

<script type="text/javascript">

document.onmousemove = getMousePosition; //set document to record mouse position

//initialize arrays
var delayedXPos = new Array();
var delayedYPos = new Array();
var delayedTime = new Array();

var xPosArr = new Array();
var yPosArr = new Array();

//initialize time variables
var initTime = new Date().getTime();
var dt=100;
var timer_is_on=0;
var t;

//function that determines action when mouse moves
function getMousePosition(mp) 
{
 var divPos = getPosition(document.getElementById("mousearea"));
 xPosArr.push(mp.pageX - divPos[0]);
 yPosArr.push(mp.pageY - divPos[1]);
 return true;
}

function timedCount()
{
 delayedXPos.push(xPosArr[xPosArr.length-1]);
 delayedYPos.push(yPosArr[yPosArr.length-1]);
 var timeInSec = (new Date().getTime()-initTime) / 1000.;
 delayedTime.push(timeInSec);
 t=setTimeout("timedCount()",dt);
}

function doTimer()
{
 if (!timer_is_on)
 {
  initTime = new Date().getTime();
  timer_is_on=1;
  timedCount();
 }
}

function stopCount()
{
  clearTimeout(t);
  timer_is_on=0;
  document.getElementById("xPos").value = delayedXPos.join();
  document.getElementById("yPos").value = delayedYPos.join();
  document.getElementById("time").value = delayedTime.join();
}


function getPosition(obj){
    
var topValue= 0,leftValue= 0;
    
while(obj)
{
 leftValue+= obj.offsetLeft;
 topValue+= obj.offsetTop;
 obj= obj.offsetParent;
}
    
return [leftValue, topValue];
}
</script>
